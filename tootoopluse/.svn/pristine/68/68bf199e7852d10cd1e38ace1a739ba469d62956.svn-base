package com.ninetowns.tootoopluse.fragment;

import java.util.List;

import android.content.Context;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.widget.BaseAdapter;
import android.widget.LinearLayout;
import android.widget.ListView;
import android.widget.TextView;

import com.ninetowns.library.net.RequestParamsNet;
import com.ninetowns.tootoopluse.R;
import com.ninetowns.tootoopluse.bean.AddressListBean;
import com.ninetowns.tootoopluse.helper.TootooeNetApiUrlHelper;
import com.ninetowns.tootoopluse.parser.AddressListParser;
import com.ninetowns.ui.fragment.BaseFragment;

public class AddressListFragment extends BaseFragment<List<AddressListBean>, AddressListParser> {
	
	private ListView address_fragment_lv;
	
	private String act_id = "";
	
	@Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
            Bundle savedInstanceState) {
        
    	View view = inflater.inflate(R.layout.address_list_fragment, null);
    	//返回
		LinearLayout two_or_one_btn_head_back = (LinearLayout)view.findViewById(R.id.two_or_one_btn_head_back);
		two_or_one_btn_head_back.setOnClickListener(new OnClickListener() {
			
			@Override
			public void onClick(View v) {
				// TODO Auto-generated method stub
				getActivity().finish();
			}
		});
		
		//标题
		TextView two_or_one_btn_head_title = (TextView)view.findViewById(R.id.two_or_one_btn_head_title);
		two_or_one_btn_head_title.setText(R.string.address_list_title);
    	
		
		address_fragment_lv = (ListView)view.findViewById(R.id.address_fragment_lv);
		
    	
    	return view;
	 }
	
	@Override
    public void onActivityCreated(Bundle savedInstanceState) {
		
		act_id = getActivity().getIntent().getStringExtra(TootooeNetApiUrlHelper.ACTIVITYID);
		
        super.onLoadData(true, false, false);
        super.onActivityCreated(savedInstanceState);
    }


	@Override
	public AddressListParser setParser(String str) {
		// TODO Auto-generated method stub
		return new AddressListParser(str);
	}

	@Override
	public void getParserResult(List<AddressListBean> parserResult) {
		// TODO Auto-generated method stub
		
		if(parserResult != null){
			
			address_fragment_lv.setAdapter(new AddressLvAdapter(getActivity(), parserResult));
		}
		
	}

	@Override
	public RequestParamsNet getApiParmars() {
		// TODO Auto-generated method stub
		RequestParamsNet requestParamsNet = new RequestParamsNet();
		requestParamsNet.setmStrHttpApi(TootooeNetApiUrlHelper.ADDRESS_LIST_URL);
		requestParamsNet.addQueryStringParameter(TootooeNetApiUrlHelper.ADDRESS_LIST_ACT_ID, act_id);
		
		return requestParamsNet;
	}
	
	
	class AddressLvAdapter extends BaseAdapter{
		
		private Context context;
		
		private List<AddressListBean> list;
		
		public AddressLvAdapter(Context context, List<AddressListBean> list){
			this.context = context;
			
			this.list = list;
		}

		@Override
		public int getCount() {
			// TODO Auto-generated method stub
			if(list != null && list.size() > 0){
				return list.size();
			} else {
				return 0;
			}
			
		}

		@Override
		public Object getItem(int arg0) {
			// TODO Auto-generated method stub
			return null;
		}

		@Override
		public long getItemId(int arg0) {
			// TODO Auto-generated method stub
			return 0;
		}

		@Override
		public View getView(int position, View convertView, ViewGroup parent) {
			// TODO Auto-generated method stub
			ViewHolder vh = null;
			if(convertView == null){
				vh = new ViewHolder();
				convertView = LayoutInflater.from(context).inflate(R.layout.address_lv_item, null);
				vh.address_item_name = (TextView)convertView.findViewById(R.id.address_item_name);
				vh.address_item_phone_num = (TextView)convertView.findViewById(R.id.address_item_phone_num);
				vh.address_item_details = (TextView)convertView.findViewById(R.id.address_item_details);
				vh.address_item_post_code = (TextView)convertView.findViewById(R.id.address_item_post_code);
				
				convertView.setTag(vh);
			} else {
				vh = (ViewHolder)convertView.getTag();
			}
			if(!TextUtils.isEmpty(list.get(position).getAddress_memberCount())){
				vh.address_item_name.setText(list.get(position).getAddress_realName() + "  (" + list.get(position).getAddress_memberCount() + "份)");
			} else {
				vh.address_item_name.setText(list.get(position).getAddress_realName() + "  (0份)");
			}
			
			if(!TextUtils.isEmpty(list.get(position).getAddress_phoneNumber())){
				vh.address_item_phone_num.setText(list.get(position).getAddress_phoneNumber());	
			} else {
				vh.address_item_phone_num.setText("");	
			}
			
			if(!TextUtils.isEmpty(list.get(position).getAddress_detail())){
				vh.address_item_details.setText(list.get(position).getAddress_detail());
			} else {
				vh.address_item_details.setText("");
			}
			if(!TextUtils.isEmpty(list.get(position).getAddress_postcode())){
				vh.address_item_post_code.setText(list.get(position).getAddress_postcode());
			} else {
				vh.address_item_post_code.setText("");
			}
			
			
			return convertView;
		}
		
		class ViewHolder{
			TextView address_item_name, address_item_phone_num, address_item_details, address_item_post_code;
		}
	}
	
}
